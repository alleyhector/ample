<div class= "container">

  <div class="row review-business-top-row">
    <div class="col-12 col-lg-6">
      <span class="dr-name"><%- name -%></span>
      <br />
      <%- formatted_address -%>
      <br />
      <%- formatted_phone_number -%>
    </div>
  </div>

  <div class="row review-title">
    <div class="col-12">
      <img src="/static/write-review.png" />
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <form class="main-form" method="POST" action="/businesses/<%- googleId -%>/reviews">
        <div class="row form-group">
          <div class="col-12 col-lg-6">
            <% for (const criteria in CRITERIA_DESCRIPTIONS) { %>
              <% const ratingName = `${criteria}-rating`; %>
              <label class="star-rating-label" for="<%- ratingName -%>"><%- CRITERIA_DESCRIPTIONS[criteria] -%> Rating</label>
              <div class="star-rating" id="<%- ratingName -%>" data-name="<%- ratingName -%>"></div>
            <% } %>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-12 col-lg-10">
            <textarea class="form-control" name="content" rows="8" placeholder="Clarify your rating with a review!"></textarea>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-12 col-lg-10">
            <small class="tag-label" for="tag-input">Add tags that describe key aspects of this business.</small>
            <div id="tag-input-outer-div" class="form-control">
              <ul id="tag-list" class="tag-list">
              </ul>
              <input id="tag-input" type="text" class="tag-input"/>
            </div>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-12 col-lg-5">
            <small for="parent-category">Help us to know what kind of business this is.</small>
            <select id="parent-category-select" class="form-control" name="parent-category">
              <option disabled selected="selected" value="">Select a category</option>
              <% for (const category in childCategoriesByParentCategory) { %>
                <option value="<%- category -%>"><%- category -%></option>
              <% } %>
            </select>
          </div>

          <div class="col-12 col-lg-5">
            <small for="parent-category">Some subcategories...</small>
            <select id="child-category-select" class="form-control" name="child-category">
            </select>
          </div>
        </div>

        <div class="row form-group">
          <div class="col-12 col-lg-10">
            <button type="submit" class="btn review-submit-button" >Submit Review</button>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>

<%- contentFor('scripts') -%>
<script>
const childCategoriesByParentCategory = <%- JSON.stringify(childCategoriesByParentCategory) %>;

const parentCategorySelect = document.getElementById('parent-category-select');
const childCategorySelect = document.getElementById('child-category-select');
parentCategorySelect.addEventListener('change', (event) => {
  const parentCategory = parentCategorySelect.value;
  const childCategories = childCategoriesByParentCategory[parentCategory];
  childCategorySelect.innerHTML = '<option></option>';

  for (const childCategory of childCategories) {
    const option = document.createElement('option');
    option.innerText = childCategory;
    option.value = childCategory;
    childCategorySelect.appendChild(option);
  }
});

ample.setUpStarRatings();
ample.enableSubmitButton(
  document.getElementsByTagName('form')[0],
  (parameters) => {
    if (!parameters.content) {
      return false;
    }

    if (!parameters['fat-rating'] && !parameters['trans-rating'] && !parameters['disabled-rating']) {
      return false;
    }

    if (!parameters['parent-category']) {
      return false;
    }

    return true;
  }
);

const tagInput = document.getElementById('tag-input');
const tagInputList = document.getElementById('tag-list');

tagInput.addEventListener('keydown', (e) => {
  if (e.keyCode == '13' && tagInput.value.length > 0) {
    event.preventDefault();
    const tagInput = document.getElementById('tag-input');
    const tagListItem = document.createElement("li");
    const tagListItemInput = document.createElement('input')
    const tagListItemDeleteLink = document.createElement('a');
    const tagListItemContent = document.createElement('span');
    tagListItemContent.className = 'tag-list-item-content';
    tagListItemContent.innerText = tagInput.value;
    tagListItemDeleteLink.innerText = 'Ã—';
    tagListItemDeleteLink.className = 'tag-list-item-delete-link';
    tagListItemDeleteLink.href = '#';

    tagListItemDeleteLink.addEventListener('click', e => {
      e.preventDefault();
      tagListItem.remove();
      tagInput.focus();
    });

    tagListItemInput.value = tagInput.value;
    tagListItemInput.type = 'hidden';
    tagListItemInput.name = `tags[]`;
    tagListItem.className = 'tag-list-item';
    tagListItem.appendChild(tagListItemInput);
    tagListItem.appendChild(tagListItemContent);
    tagListItem.appendChild(tagListItemDeleteLink);
    tagInputList.appendChild(tagListItem);
    tagInput.value = "";
    return;
  }

  if (e.keyCode == 8 && tagInput.value.length === 0 && tagInputList.lastChild) {
    tagInputList.lastChild.remove();
  }
});

</script>

<%- contentFor('title') -%>
Ample | New Review
