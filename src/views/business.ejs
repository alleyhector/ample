<div class="container">
  <div class="row business-header">

    <div class="col-12 col-lg-8 align-self-end order-12">

        <h1 class="dr-name"><%- business.name -%></h1>
        <p class="business-by-line address"> <%- business.formatted_address -%></p>
        <p class="business-by-line"> <%- business.formatted_phone_number -%></p>

      <div class="row score-row">
        <% if (reviews.length != 0) { %>
          <div class="col-6 rating-doodad">
            <span class="summary-item">
              <%- business.overallRating -%>
            </span>
            <img src="/static/star-highlight-large.png" class="indicator" />
            <br />
            <span>Overall Rating</span>
          </div>

          <div class="col-6 rating-doodad">
            <span class="summary-item">
              <%- business.reviewCount -%>
            </span>
            <img src="/static/checkmark.png" class="indicator" />
            <br />
            <span>Total reviews</span>
          </div>
        <% } %>
      </div>
    </div>

    <div class="col-12 col-lg-4 align-self-end order-1 order-lg-12 biz-image-col">
      <% if (photoURL) { %>
      <img
      class="img-fluid biz-img"
      src="<%- photoURL -%>"
      />
      <% } else { %>
      <img
      class="img-fluid biz-img"
      src="/static/placeholder-wide.png"
      />
      <% } %>
    </div>
  </div>

  <% if (reviews.length != 0) { %>
    <div class="row border-top border-bottom breakdown-section">
        <div class="col-12 col-lg-2">
          Score Breakdown:
        </div>
        <div class="col-12 col-lg-2">
          <a
            id="rating-breakdown-bodyPositivity-link"
            class="rating-breakdown-link"
            href="#">
            Body Positivity
          </a>
        </div>
        <div class="col-12 col-lg-2">
          <a
            id="rating-breakdown-lgbtqInclusivity-link"
            class="rating-breakdown-link"
            href="#">
            LGBTQ Inclusivity
          </a>
        </div>
        <div class="col-12 col-lg-2">
          <a
            id="rating-breakdown-pocInclusivity-link"
            class="rating-breakdown-link"
            href="#">
            POC Inclusivity
          </a>
        </div>
        <div class="col-12 col-lg-2">
          <a
            id="rating-breakdown-furnitureSize-link"
            class="rating-breakdown-link"
            href="#">
            Furniture Size
          </a>
        </div>
        <div class="col-12 col-lg-2">
          <a
            id="rating-breakdown-buildingAccessibility-link"
            class="rating-breakdown-link"
            href="#">
            Building Accessibility
          </a>
        </div>
    </div>


    <% for (const categoryName in ratingBreakdown) { %>
      <div class="row rating-breakdown" id="rating-breakdown-<%- categoryName -%>" style="display: none;">
        <div class="col-12 col-md-4">
          <% for (const ratingValue of [5, 4, 3, 2, 1]) { %>
            <div class="row">
              <div class="col-3">
                <%- ratingValue %>
                <img src="/static/star-highlight-small.png" class="indicator" />
              </div>

              <div class="col-6">
                <div class="percentage-bar-background">
                  <%
                    const percentage =
                      ratingBreakdown[categoryName][ratingValue] /
                      ratingBreakdown[categoryName].total * 100;
                  %>
                  <div class="percentage-bar" style="width: <%- percentage -%>%;">
                  </div>
                </div>
              </div>

              <div class="col-1">
                <span>(<%- ratingBreakdown[categoryName][ratingValue] -%>)</span>
              </div>
            </div>
          <% } %>
        </div>
      </div>
    <% } %>
  <% } %>

  <div class="row reviews-header">
    <div class="col-4 col-lg-2">
      <h3 class="review">Reviews</h3>
    </div>

    <div class="col-6">
      <a
        class="btn btn-info review-button"
        href="/businesses/<%- googleId -%>/reviews/new"
        role="button">Add Your Review</a>
    </div>
  </div>

  <div class="row reviews-body">
    <div class="col-12">
    <% if (reviews.length != 0) { %>
        <ul class="list-group list-group-flush">
          <% for (const review of reviews) { %>
            <li class="list-group-item">
              <div class="row">
                <div class="col-12 col-md-6 col-lg-2 order-1">
                  <span class="reviewed-by">Reviewed by <%- review.user.name -%></span>
                  <span class="reviewed-by"><%- review.date -%></span>
                </div>
                <div class="col-12 col-lg-2 order-12">
                  <% if (user.id === review.user.id) { %>
                  <a href="/businesses/<%- googleId -%>/reviews/<%- review.review_id -%>/edit">edit review</a>
                  <% } %>
                </div>
                <div class="col-12 col-md-6  col-lg-4 star-box order-2">
                  <div class="row float-right">
                    <span class="star-rating">Body Positivity</span>
                    <div class="review-star-rating" data-value="<%- review.bodyPositivity -%>" data-size="small"></div>
                  </div>
                  <div class="row float-right">
                    <label class="star-rating">LGBTQ Inclusivity</label>
                    <div class="review-star-rating" data-value="<%- review.lgbtqInclusivity -%>" data-size="small">
                    </div>
                  </div>
                  <div class="row float-right">
                    <label class="star-rating">POC Inclusivity</label>
                    <div class="review-star-rating" data-value="<%- review.pocInclusivity -%>" data-size="small">
                    </div>
                  </div>
                  <div class="row float-right">
                    <label class="star-rating">Building Accessibility</label>
                    <div class="review-star-rating" data-value="<%- review.buildingAccessibility -%>" data-size="small">
                    </div>
                  </div>
                  <div class="row float-right">
                    <label class="star-rating">Furniture for Fat Bodies</label>
                    <div class="review-star-rating" data-value="<%- review.furnitureSize -%>" data-size="small">
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6 review-content-col order-3">
                  <%- review.content -%>
                </div>
              </div>
              </li>
            <% } %>
          </ul>

      <% } %>
    </div>
  </div>
</div>

<%- contentFor('scripts') -%>
<script>
  const starRatingElements = document.getElementsByClassName("review-star-rating");
  for (const element of starRatingElements) {
    new ample.StarRatingView(element, false);
  }

  window.addEventListener('hashchange', showRatingBreakdownForHash);

  showRatingBreakdownForHash();

  function showRatingBreakdownForHash(event) {
    for (const ratingBreakdownDiv of document.getElementsByClassName('rating-breakdown')) {
      ratingBreakdownDiv.style.display = 'none';
    }
    for (const ratingBreakdownLink of document.getElementsByClassName('rating-breakdown-link')) {
      ratingBreakdownLink.classList.remove('highlighted');
      ratingBreakdownLink.href = "#" + ratingBreakdownLink.id.replace(/-link$/, '');
    }

    const ratingBreakdownId = location.hash.slice(1);
    const selectedRatingBreakdownDiv = document.getElementById(ratingBreakdownId);
    if (selectedRatingBreakdownDiv) {
      selectedRatingBreakdownDiv.style.display = 'block';
    }

    const selectedRatingBreakdownLink = document.getElementById(ratingBreakdownId + '-link');
    if (selectedRatingBreakdownLink) {
      selectedRatingBreakdownLink.classList.add('highlighted');
      selectedRatingBreakdownLink.href = '#';
    }
  }
</script>

<%- contentFor('title') -%>
Ample | <%- business.name -%>
